<!DOCTYPE html >
<html>
<head>
    <meta charset="UTF-8">
    <!-- import CSS -->
    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
    <link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.15.4/dist/bootstrap-table.min.css">
    <style>
        #app{
            margin-left: 30px;
            margin-right: 35px;
        }
        #suggestion{
            margin-top: 20px;
        }
        #payPoRelationDetail{
            font-size: 25px;
        }
        #agree,#refuse{
            font-size: 25px;
            margin-top: 20px;
            margin-left: 230px;
        }
    </style>
</head>
<body>
<div id="app">
    <div>
        <h1>付款单详情</h1>
        <h5>付款编号: {{payOrder.payNo}}</h5>
        <h5>项目: {{payOrder.projectName}}</h5>
        <h5>收款经营单位: {{payOrder.payeeName}}</h5>
        <h5>付款金额: {{payOrder.payAmount}} 元</h5>
        <h5>预收金额: {{payOrder.advanceAmount}} 元</h5>
        <h5>备注: {{payOrder.remark}}</h5>
    </div>
    <hr>
    <p class="btn btn-primary btn-sm" @click="payPoRelationDetail()">付款订单明细</p>
<!--    <div v-if="seen" v-for="(item,i) in payOrderDetail">-->
<!--        <h5>订单编号: {{item.orderNo}}</h5>-->
<!--        <h5>商品编号: {{item.goodsNo}}</h5>-->
<!--        <h5>商品名称: {{item.goodsName}}</h5>-->
<!--        <h5>订单日期: {{item.orderTime}}</h5>-->
<!--        <h5>采购数量: {{item.goodsNum}}</h5>-->
<!--        <h5>采购单价：{{item.goodsPrice}} 元</h5>-->
<!--        <h5>采购金额：{{item.goodsAmount}} 元</h5>-->
<!--        <h5>本次付款金额：{{item.payAmount}} 元</h5>-->
<!--        <hr>-->
<!--    </div>-->
    <!--<p class="btn btn-primary btn-sm" @click="payAdvanceDetail()">付款预收明细</p>-->
    <h1>审核记录</h1>
    <div v-for="record in verifyRecords">
        <h5>流程节点：{{record.stateName}}</h5>
        <h5>处理人：{{record.dealName}}</h5>
        <h5>处理意见：{{record.suggestion}}</h5>
        <h5>处理时间：{{record.dealTime}}</h5>
        <hr>
    </div>
    <div class="form-group">
        <textarea cols="30" rows="10" class="form-control" v-model="suggestion"></textarea>
    </div>
    <p id="agree" class="btn btn-primary btn-lg" @click="verifyPass()">同意</p>
    <p id="refuse" class="btn btn-danger btn-lg" @click="verifyRefuse()">驳回</p>
</div>
</body>
<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>
<script src="https://unpkg.com/bootstrap-table@1.15.4/dist/bootstrap-table.min.js"></script>
<script src="https://cdn.bootcss.com/vue/2.2.2/vue.min.js"></script>
<script src="https://cdn.bootcss.com/axios/0.19.0-beta.1/axios.min.js"></script>
<script src="https://unpkg.com/bootstrap-table@1.15.4/dist/locale/bootstrap-table-zh-CN.min.js"></script>
<script src="https://cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="https://cdn.bootcss.com/layer/2.3/layer.js"></script>
<script>
    const vm = new Vue({
        el: '#app',
        data() {
            return {
                auditId: '',
                payId: '',
                suggestion: '',
                payOrder: {},
                verifyRecords: [],
                payOrderDetail: [],
                seen: false,
                domain: 'http://localhost:9090/'
                // domain: 'http://devwx.asters.cn/'
                // domain: 'http://dev.asters.cn:9090/'
                // domain: 'http://xcra5j.natappfree.cc/'
            }
        },
        mounted() {
            this.list();
            this.auditRecords();
        },
        methods: {
            list() {
                const url = this.domain + "pay/payOrderDetail";
                axios.get(url, {
                    params: {
                        payId: $.cookie('payId')
                    }
                })
                    .then((response) => {
                        console.log(response);
                        this.payOrder = response.data.data.payOrderResDto;
                        console.log(this.payOrder);
                    })
                    .catch((error) => {
                        console.log(error);
                    });
            },
            payPoRelationDetail() {
                console.log(this.seen);
                console.log(this.payId);
                this.seen = true;
                const url = this.domain + "pay/payPoRelationDetail";
                console.log($.cookie('payId'));
                axios.get(url, {
                    params: {
                        payId: $.cookie('payId')
                    }
                })
                    .then((response) => {
                        console.log(response);
                        this.payOrderDetail = response.data.data.payPoRelationResDto;
                        console.log(this.payOrderDetail);
                    })
                    .catch((error) => {
                        console.log(error);
                    })
            },
            payAdvanceDetail() {
                //跳转单据详情页面
                window.location.href = "payAdvanceDetail.html";
            },
            auditRecords() {
                const url = this.domain + "pay/auditRecords";
                axios.get(url, {
                    params: {
                        projectItemId: $.cookie('payId')
                    }
                })
                    .then((response) => {
                        console.log("审核记录");
                        console.log(response);
                        this.verifyRecords = response.data.data.items;
                    })
                    .catch((error) => {
                        console.log(error);
                    });
            },
            verifyPass() {
                if (this.suggestion == '') {
                    layer.alert("请填写理由");
                    return false;
                }
                const url = this.domain + "pay/verifyPass";
                axios.get(url, {
                    params: {
                        auditId: $.cookie('auditId'),
                        projectItemId: $.cookie('payId'),
                        suggestion: this.suggestion,
                        operation: 1,
                        state: $.cookie('state')
                    }
                })
                    .then((response) => {
                        layer.msg("保存成功！", {
                            icon: 1,
                            time: 1500
                        }, function () {
                        });
                        window.location.href = this.domain + "wechat/portal/waitingPayOrderList";

                    })
                    .catch((error) => {
                        console.log(error);
                        layer.msg(error.data.msg, {
                            icon: 1,
                            time: 1500
                        }, function () {
                        });
                        window.location.href = this.domain + "wechat/portal/waitingPayOrderList";
                    });
            },
            verifyRefuse() {
                const url = this.domain + "pay/verifyPass";
                axios.get(url, {
                    params: {
                        auditId: $.cookie('auditId'),
                        projectItemId: $.cookie('payId'),
                        suggestion: this.suggestion,
                        operation: 1
                    }
                })
                    .then((response) => {
                        layer.msg("保存成功！", {
                            icon: 1,
                            time: 1500
                        }, function () {
                        });
                        window.location.href = this.domain + "wechat/portal/waitingPayOrderList";
                    })
                    .catch((error) => {
                        console.log(error);
                    });
            }

        }
    })
</script>
</html>
