<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <!-- import CSS -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <style>
        .el-table{
            overflow:visible !important;
        }
    </style>
</head>
<body>
<div id="app">
    <el-button type="primary" icon="el-icon-reading" v-if='flag==true' @click='switchChange'>付款订单明细</el-button>
    <el-button type="primary" icon="el-icon-notebook-1" v-if='flag==false' @click='switchChange'>付款订单明细</el-button>

    <el-table
        :data="tableData"
        border
        :summary-method="getSummaries"
        v-if="seen"
        show-summary
        style="width: 100%; margin-top: 10px">
        <el-table-column prop="id" label="ID"></el-table-column>
        <el-table-column prop="barCode" label="商品国际码"></el-table-column>
        <el-table-column prop="goodsName" label="商品名称"></el-table-column>
        <el-table-column prop="unit" label="商品单位"></el-table-column>
        <el-table-column prop="goodsNum" label="采购数量"></el-table-column>
        <el-table-column prop="goodsPrice" label="采购单价(元)"></el-table-column>
        <el-table-column prop="requiredSendPrice" label="销售单价(元)"></el-table-column>
        <el-table-column prop="goodsAmount" label="采购金额(元)"></el-table-column>
        <el-table-column prop="arrivalAmount" label="销售金额(元)"></el-table-column>
        <el-table-column prop="payAmount" label="本次付款金额(元)"></el-table-column>
        <el-table-column prop="discountRateStr" label="折扣率"></el-table-column>
        <el-table-column prop="grossProfitRateStr" label="毛利率"></el-table-column>
    </el-table>
</div>
</body>
<!-- import Vue before Element -->
<script src="https://unpkg.com/vue/dist/vue.js"></script>
<script src="https://cdn.bootcss.com/axios/0.19.0-beta.1/axios.min.js"></script>
<!-- import JavaScript -->
<script src="https://unpkg.com/element-ui/lib/index.js"></script>
<script>
    const vm = new Vue({
        el: '#app',
        data() {
            return {
                flag: true,
                seen: false,
                domain: 'http://localhost:9090/',
                tableData: []
            }
        },
        mounted() {
            console.log('mounted');
            this.payPoRelationDetail();
        },
        methods: {
            switchChange(){
                this.flag = !this.flag;
                if(this.flag==true){
                    this.seen=false;
                }else if(this.flag==false){
                    this.seen = true;
                }
            },
            payPoRelationDetail() {
                const url = this.domain + "pay/payPoRelationDetail";
                axios.get(url, {
                    params: {
                        payId: 64
                    }
                })
                    .then((response) => {
                        console.log(response);
                        this.tableData = response.data.data.payPoRelationResDto;
                        console.log(this.tableData);
                    })
                    .catch((error) => {
                        console.log(error);
                    })
            },
            getSummaries(param) {
                const { columns, data } = param;
                const sums = [];
                columns.forEach((column, index) => {
                    if (index === 0) {
                        sums[index] = '总价';
                        return;
                    }
                    const values = data.map(item => Number(item[column.property]));
                    if (!values.every(value => isNaN(value))) {
                        sums[index] = values.reduce((prev, curr) => {
                            const value = Number(curr);
                            if (!isNaN(value)) {
                                return prev + curr;
                            } else {
                                return prev;
                            }
                        }, 0);
                        if (index === 1){
                            sums[index] = ''
                        }else if (index === 4){
                            sums[index] += ''
                        }else{
                            sums[index] += ' 元';
                        }
                    } else {
                        sums[index] = '';
                    }
                });
                return sums;
            }
        }
    })
</script>
</html>
